[gd_scene format=3 uid="uid://bnrxygybf12so"]

[ext_resource type="PackedScene" uid="uid://bynkfykxpprpw" path="res://scenes/common/Player.tscn" id="1_player"]
[ext_resource type="Script" uid="uid://b8pn1xqg35okm" path="res://scripts/items/MaterialItem.cs" id="2_material"]
[ext_resource type="PackedScene" uid="uid://d4mweouara7f6" path="res://scenes/ui/InventoryUI.tscn" id="3_invui"]
[ext_resource type="Script" uid="uid://dikrf38o7uy4a" path="res://scripts/levels/GameSetup.cs" id="4_setup"]
[ext_resource type="Script" uid="uid://ckddjniep801c" path="res://scripts/ui/BookUI.cs" id="5_bookui"]
[ext_resource type="Script" uid="uid://bh7yuw6ath05" path="res://scripts/puzzles/MixingPuzzle.cs" id="6_mixpuzzle"]
[ext_resource type="PackedScene" uid="uid://bh7y0kxlmqe5" path="res://scenes/ui/MixingUI.tscn" id="7_mixui"]
[ext_resource type="Script" uid="uid://ul57620skni6" path="res://scripts/items/BookItem.cs" id="8_bookitem"]
[ext_resource type="PackedScene" uid="uid://cpj1vkmfr8tn1" path="res://scenes/ui/QuantityPickerUI.tscn" id="9_qtyui"]
[ext_resource type="PackedScene" uid="uid://cl25celniqxra" path="res://scenes/ui/FinalMixingUI.tscn" id="10_finalmix"]
[ext_resource type="Script" uid="uid://d1m5oeeek4xlm" path="res://scripts/puzzles/FinalMixingPuzzle.cs" id="11_finalpuzzle"]
[ext_resource type="Script" path="res://scripts/common/LevelTransitionArea.cs" id="12_transition"]
[ext_resource type="PackedScene" uid="uid://bqw5x8nj7m8yc" path="res://scenes/ui/MiniMap.tscn" id="13_3bs35"]
[ext_resource type="Script" uid="uid://bvnsdjc7nbgdd" path="res://scripts/common/AutoDoor.cs" id="13_autodoor"]
[ext_resource type="Texture2D" uid="uid://cmh6yh2g2w3g6" path="res://assets/sprites/lab/poster_ingredients_1080x1350.png" id="15_poster"]

[sub_resource type="QuadMesh" id="QuadMesh_poster"]
size = Vector2(1.6, 2)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_poster"]
transparency = 1
shading_mode = 0
albedo_texture = ExtResource("15_poster")

[sub_resource type="BoxShape3D" id="BoxShape3D_poster"]
size = Vector3(1.6, 2, 0.2)

[sub_resource type="BoxMesh" id="BoxMesh_floor"]
size = Vector3(25, 0.2, 20)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_lab"]
albedo_color = Color(0.8, 0.85, 0.9, 1)

[sub_resource type="BoxShape3D" id="BoxShape3D_floor"]
size = Vector3(25, 0.2, 20)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_smallcauldron"]
albedo_color = Color(0.25, 0.25, 0.25, 1)
metallic = 0.7
roughness = 0.4

[sub_resource type="CylinderMesh" id="CylinderMesh_smallcauldron"]
material = SubResource("StandardMaterial3D_smallcauldron")
top_radius = 0.6
bottom_radius = 0.4
height = 0.8

[sub_resource type="CylinderShape3D" id="CylinderShape3D_smallcauldron"]
height = 0.8
radius = 0.6

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_autodoor"]
albedo_color = Color(0.7, 0.7, 0.75, 1)
metallic = 0.9
roughness = 0.2

[sub_resource type="BoxMesh" id="BoxMesh_autodoor"]
material = SubResource("StandardMaterial3D_autodoor")
size = Vector3(3.5, 4, 0.3)

[sub_resource type="BoxShape3D" id="BoxShape3D_autodoor"]
size = Vector3(3.5, 4, 0.3)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_cauldron"]
albedo_color = Color(0.15, 0.15, 0.15, 1)
metallic = 0.8
roughness = 0.3

[sub_resource type="CylinderMesh" id="CylinderMesh_cauldron"]
material = SubResource("StandardMaterial3D_cauldron")
top_radius = 1.2
bottom_radius = 0.8
height = 1.5

[sub_resource type="CylinderShape3D" id="CylinderShape3D_cauldron"]
height = 1.5
radius = 1.2

[sub_resource type="SphereMesh" id="SphereMesh_item"]
radius = 0.3
height = 0.6

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_green"]
albedo_color = Color(0.2, 0.8, 0.2, 1)

[sub_resource type="SphereShape3D" id="SphereShape3D_item"]
radius = 0.3

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_red"]
albedo_color = Color(0.9, 0.2, 0.2, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_blue"]
albedo_color = Color(0.2, 0.5, 1, 1)

[sub_resource type="BoxMesh" id="BoxMesh_transition"]
size = Vector3(3, 0.2, 3)

[sub_resource type="BoxShape3D" id="BoxShape3D_transition"]
size = Vector3(3, 0.5, 3)

[node name="Main" type="Node3D" unique_id=1136436961]

[node name="RecipeBook" type="StaticBody3D" parent="." unique_id=1146817893 groups=["minimap_interactable"]]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, -11, 2.5, -0.58407104)
script = ExtResource("8_bookitem")
BookTitle = "Tri-Color Synthesis Manual"
BookContent = "[center][b]‚öóÔ∏è TRI-COLOR SYNTHESIS ‚öóÔ∏è[/b][/center]
[center][i]The Alchemist's Lab - Advanced Color Theory[/i][/center]

---

[b]OBJECTIVE:[/b]
Create the [color=cyan]Teal Potion[/color] to dissolve the rusted steel door.

[b]‚ö†Ô∏è CRITICAL WARNING ‚ö†Ô∏è[/b]
[color=red]DO NOT mix all three primary materials at once!
This will create useless Black Mud![/color]

---

[b]MATERIALS SCATTERED IN LAB:[/b]

üåø [color=lime]Green Moss[/color] - Found near the shelf
üï∑Ô∏è [color=red]Red Powder[/color] - On the counter
‚ú® [color=cyan]Blue Extract[/color] - Near equipment

[i]Collect up to 3 of each material for the synthesis.[/i]

---

[b]THE TRI-COLOR SYNTHESIS PROCESS:[/b]

[color=yellow][b]STEP 1: Create Secondary Potions[/b][/color]

Recipe 1: [color=lime]Green Moss[/color] + [color=red]Red Powder[/color] = üíõ [color=yellow]Yellow Potion[/color]
Recipe 2: [color=red]Red Powder[/color] + [color=cyan]Blue Extract[/color] = üíó [color=magenta]Magenta Potion[/color]  
Recipe 3: [color=cyan]Blue Extract[/color] + [color=lime]Green Moss[/color] = üíô [color=cyan]Cyan Potion[/color]

[i]These secondary potions will be stored automatically.[/i]

---

[color=cyan][b]STEP 2: Final Synthesis[/b][/color]

Combine ALL three secondary potions:
üíõ [color=yellow]Yellow[/color] + üíó [color=magenta]Magenta[/color] + üíô [color=cyan]Cyan[/color] = [color=cyan][b]TEAL POTION[/b][/color] ‚úì

---

[b]WHY THIS ORDER MATTERS:[/b]

[color=red]‚ùå WRONG:[/color] üåø Green + üï∑Ô∏è Red + ‚ú® Blue = üíÄ Black Mud (USELESS!)

[color=green]‚úì CORRECT:[/color] Create 3 secondary potions first, then combine them!

\"Teal perfection can only be achieved through the unity of three soul colors (Secondary), not from raw materials.\"

---

[b]PROCEDURE:[/b]

1. Collect all three primary materials from the lab (you can pick multiple at once)
2. Go to Magic Table and open synthesis UI
3. Add 2 materials to cauldron and MIX to create secondary potion
4. Repeat until you have all 3 secondary potions in storage
5. Add all 3 secondary potions to cauldron
6. MIX to create Teal Potion!

[color=yellow]HINT:[/color] You need to create EACH secondary potion separately. This will consume your materials, so collect wisely!

[right]- Master Alchemist[/right]"
PosterImagePath = "res://assets/sprites/lab/poster_ingredients_1080x1350.png"
ItemId = "recipe_poster"
ItemName = "Recipe Poster"
MaxStackSize = 1

[node name="PosterContent" type="Sprite3D" parent="RecipeBook" unique_id=1306877694]
transform = Transform3D(-4.371139e-08, 0, -1, 0, 1, 0, 1, 0, -4.371139e-08, 1.37, 0, 1.625)
visible = false
pixel_size = 0.001
shaded = true
double_sided = false
texture = ExtResource("15_poster")

[node name="MeshInstance3D" type="MeshInstance3D" parent="RecipeBook" unique_id=1774574293]
transform = Transform3D(-4.371139e-08, 0, -1, 0, 1, 0, 1, 0, -4.371139e-08, 1.3966265, 0, 1.6248168)
mesh = SubResource("QuadMesh_poster")
surface_material_override/0 = SubResource("StandardMaterial3D_poster")

[node name="CollisionShape3D" type="CollisionShape3D" parent="RecipeBook" unique_id=650125762]
transform = Transform3D(-4.371139e-08, 0, -1, 0, 1, 0, 1, 0, -4.371139e-08, 1.397, 0, 1.625)
shape = SubResource("BoxShape3D_poster")

[node name="Player" parent="." unique_id=1725543223 instance=ExtResource("1_player")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2, 8)

[node name="Floor" type="StaticBody3D" parent="." unique_id=1702196355]

[node name="MeshInstance3D" type="MeshInstance3D" parent="Floor" unique_id=232413335]
mesh = SubResource("BoxMesh_floor")
surface_material_override/0 = SubResource("StandardMaterial3D_lab")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Floor" unique_id=1577500486]
shape = SubResource("BoxShape3D_floor")

[node name="Walls" type="Node3D" parent="." unique_id=2134685429]

[node name="WallNorth" type="CSGBox3D" parent="Walls" unique_id=477838150]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.5, -10)
use_collision = true
size = Vector3(25, 5, 0.2)

[node name="WallSouth" type="CSGBox3D" parent="Walls" unique_id=3530530]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.5, 10)
use_collision = true
size = Vector3(25, 5, 0.2)

[node name="WallEast" type="CSGBox3D" parent="Walls" unique_id=765077847]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 12.5, 2.5, 0)
use_collision = true
size = Vector3(0.2, 5, 20)

[node name="WallWest" type="CSGBox3D" parent="Walls" unique_id=352560410]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -12.5, 2.5, 0)
use_collision = true
size = Vector3(0.2, 5, 20)

[node name="DividingWallNorth" type="CSGBox3D" parent="Walls" unique_id=1923456789]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5, 2.5, -5.9301147)
use_collision = true
size = Vector3(0.2, 5, 8.1397705)

[node name="DividingWallSouth" type="CSGBox3D" parent="Walls" unique_id=1923456790]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5, 2.5, 5.9123535)
use_collision = true
size = Vector3(0.2, 5, 8.175293)

[node name="DividingWallTop" type="CSGBox3D" parent="Walls" unique_id=1923456791]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5, 4.539551, 0)
use_collision = true
size = Vector3(0.2, 0.92089844, 8)

[node name="Ceiling" type="CSGBox3D" parent="." unique_id=1255258577]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 5, 0)
visible = false
use_collision = true
size = Vector3(25, 0.2, 20)

[node name="KualiKecil" type="StaticBody3D" parent="." unique_id=1216210040 groups=["minimap_interactable"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.6124191, 0.4, 0.17629051)
script = ExtResource("6_mixpuzzle")

[node name="MeshInstance3D" type="MeshInstance3D" parent="KualiKecil" unique_id=1330149462]
mesh = SubResource("CylinderMesh_smallcauldron")

[node name="CollisionShape3D" type="CollisionShape3D" parent="KualiKecil" unique_id=173668773]
shape = SubResource("CylinderShape3D_smallcauldron")

[node name="AutoDoor" type="StaticBody3D" parent="." unique_id=1234567890 groups=["minimap_interactable"]]
transform = Transform3D(0, 0, 1, 0, 1, 0, -1, 0, 0, 5, 2, 0)
script = ExtResource("13_autodoor")

[node name="MeshInstance3D" type="MeshInstance3D" parent="AutoDoor" unique_id=1234567891]
mesh = SubResource("BoxMesh_autodoor")

[node name="CollisionShape3D" type="CollisionShape3D" parent="AutoDoor" unique_id=1234567892]
shape = SubResource("BoxShape3D_autodoor")

[node name="KualiBesar" type="StaticBody3D" parent="." unique_id=1850987654 groups=["minimap_interactable"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.75, -6)
script = ExtResource("11_finalpuzzle")

[node name="MeshInstance3D" type="MeshInstance3D" parent="KualiBesar" unique_id=1851987655]
mesh = SubResource("CylinderMesh_cauldron")

[node name="CollisionShape3D" type="CollisionShape3D" parent="KualiBesar" unique_id=1852987656]
shape = SubResource("CylinderShape3D_cauldron")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="." unique_id=1105362623]
transform = Transform3D(0.866025, -0.433013, 0.25, 0, 0.5, 0.866025, -0.5, -0.75, 0.433013, 0, 5, 0)
light_color = Color(1, 0.95, 0.85, 1)
shadow_enabled = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="." unique_id=22138678]

[node name="LabEquipment" type="Node3D" parent="." unique_id=1146962165]

[node name="Shelf1" type="CSGBox3D" parent="LabEquipment" unique_id=404282894]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -10, 1, -8)
use_collision = true
size = Vector3(4, 2, 0.5)

[node name="Shelf2" type="CSGBox3D" parent="LabEquipment" unique_id=1006268438]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -10, 1, -4)
use_collision = true
size = Vector3(4, 2, 0.5)

[node name="Counter" type="CSGBox3D" parent="LabEquipment" unique_id=1413545040]
transform = Transform3D(0, 0, 1, 0, 1, 0, -1, 0, 0, -11, 0.5, 4)
use_collision = true
size = Vector3(8, 1, 2)

[node name="Items" type="Node3D" parent="." unique_id=1649151714]

[node name="GreenMoss" type="StaticBody3D" parent="Items" unique_id=1252871519]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -11.843592, 0.37992334, -7)
script = ExtResource("2_material")
AvailableQuantity = 3
ItemId = "green_moss"
ItemName = "Green Moss"
MaxStackSize = 10

[node name="MeshInstance3D" type="MeshInstance3D" parent="Items/GreenMoss" unique_id=1450105786]
mesh = SubResource("SphereMesh_item")
surface_material_override/0 = SubResource("StandardMaterial3D_green")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Items/GreenMoss" unique_id=2049043449]
shape = SubResource("SphereShape3D_item")

[node name="RedPowder" type="StaticBody3D" parent="Items" unique_id=324060498]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -10.675169, 1.3918908, 5.9542065)
script = ExtResource("2_material")
AvailableQuantity = 3
ItemId = "red_powder"
ItemName = "Red Powder"
MaxStackSize = 10

[node name="MeshInstance3D" type="MeshInstance3D" parent="Items/RedPowder" unique_id=1694307705]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.10580659, 0)
mesh = SubResource("SphereMesh_item")
surface_material_override/0 = SubResource("StandardMaterial3D_red")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Items/RedPowder" unique_id=1541392130]
shape = SubResource("SphereShape3D_item")

[node name="BlueExtract" type="StaticBody3D" parent="Items" unique_id=1156292908]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 2.7511075, 0.40267062, 6.4531965)
script = ExtResource("2_material")
AvailableQuantity = 3
ItemId = "blue_extract"
ItemName = "Blue Extract"
MaxStackSize = 10

[node name="MeshInstance3D" type="MeshInstance3D" parent="Items/BlueExtract" unique_id=1995237917]
mesh = SubResource("SphereMesh_item")
surface_material_override/0 = SubResource("StandardMaterial3D_blue")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Items/BlueExtract" unique_id=280504403]
shape = SubResource("SphereShape3D_item")

[node name="UI" type="CanvasLayer" parent="." unique_id=1931185845]

[node name="MiniMap" parent="UI" unique_id=929860020 instance=ExtResource("13_3bs35")]
MapPosition = Vector2(1000, 480)
MapPadding = 1.5
BackgroundColor = Color(0, 0, 0, 0.12941177)
BorderColor = Color(1, 1, 1, 1)
WallColor = Color(0, 0, 0, 1)
WallBorderColor = Color(1, 1, 1, 1)
PlayerDotSize = 8.0
ItemDotSize = 5.0
WallThickness = 100.0

[node name="InventoryUI" parent="UI" unique_id=1954206059 instance=ExtResource("3_invui")]

[node name="BookUI" type="Control" parent="UI" unique_id=1069748114]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("5_bookui")

[node name="MixingUI" parent="UI" unique_id=1072442021 instance=ExtResource("7_mixui")]

[node name="QuantityPickerUI" parent="UI" unique_id=1128363676 instance=ExtResource("9_qtyui")]

[node name="FinalMixingUI" parent="UI" unique_id=1138475789 instance=ExtResource("10_finalmix")]

[node name="GameSetup" type="Node3D" parent="." unique_id=1327659989]
script = ExtResource("4_setup")
CurrentLevel = 3

[node name="LevelTransition" type="Area3D" parent="." unique_id=1327659990]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 10, 0.1, -8)
script = ExtResource("12_transition")
NextLevel = 4
AreaColor = Color(0.2, 0.5, 1, 0.6)

[node name="MeshInstance3D" type="MeshInstance3D" parent="LevelTransition" unique_id=1327659991]
mesh = SubResource("BoxMesh_transition")

[node name="CollisionShape3D" type="CollisionShape3D" parent="LevelTransition" unique_id=1327659992]
shape = SubResource("BoxShape3D_transition")
